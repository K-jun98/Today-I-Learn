
## 📚 TIL

---

### `개인 공부`
- [X] 자바 ORM 표준 JPA 프로그래밍 3장
- [ ]
- [ ]
- [ ]

---
### `짧은 정리`

#### `변경 감지`
```java

Member member = em.find(Member.class ,"id")

member.setUsername("jun");
member.setAge(26);

//em.update(member); 

```
- JPA로 엔티티를 수정할 때는 단순히 엔티티를 조회해서 데이터만 변경하면 된다.
- 엔티티의 변경 사항을 데이터베이스에 자동으로 반영하는 기능을 `변경 감지`라 한다.
- JPA는 엔티티를 영속성 컨텍스트에 보관할 최초 상태를 복사해서 저장한다.(스냅샷)
  - 트랜잭션을 커밋하면 엔티티 매니저 내부에서 플러시가 호출
  - 엔티티와 스냅샷을 비교해서 변경된 엔티티를 찾음
  - 변경된 엔티티가 있으면 수정 쿼리를 생성해서 쓰기 지연 SQL 저장소에 보냄
  - 쓰기 지연 저장소의 SQL을 데이터베이스에 보냄
  - 데이터베이스 트랜잭션을 커밋
- 변경 감지는 영속성 컨텍스트가 관리하는 `영속 상태`의 엔티티에만 적용 

#### `플러시`
- 플러시는 영속성 컨텍스트의 변경 내용을 데이터베이스에 반영한다.
- 영속성 컨텍스트를 플러시하는 방법 3가지
  - em.flush()를 호출한다.
  - 트랜잭션 커밋 시 플러시가 자동 호출된다.
  - JPQL 쿼리 실행 시 플러시가 자동 호출된다.

#### `준영속 상태의 특징`
- 거의 비영속 상태에 가깝다.
  - `1차 캐시, 쓰기 지연, 변경 감지, 지연 로딩을 포함한 영속성 컨텍스트가 제공하는 어떠한 기능도 동작 X`
- 식별자 값을 가지고 있다.
  - 비영속 상태는 식별자 값이 없을 수도 있지만 준영속 상태는 이미 한 번 영속상태였으므로 반드시 식별자 값을 가지고 있다.
- 지연 로딩을 할 수 없다.
  - 지연 로딩은 실제 객체 대신 프록시 객체를 로딩해두고 해당 객체를 실제 사용할 때 영속성 컨텍스트를 통해 데이터를 불로으는 방법이다. 하지만 영속성
컨텍스트가 더는 관리하지 않으므로 불가능하다.